<html>
	<head>
		<meta charset="utf-8">
				
	</head>
	<body>
		<div class="container">
			<canvas id='canvas' width=1000 height=500></canvas>	
			<img src="map.png">
			<p id='label'>-</p>
			<table id="shedule" border="1">
				<tr>
					<td colspan="2">
						Две Короны
					</td>
					<td colspan="2">
						Ост-Терра
					</td>

				</tr><tr>
					<td>
						Прибытие
					</td>
					<td>
						Отплытие
					</td>
					<td>
						Прибытие
					</td>
					<td>
						Отплытие
					</td>

				</tr>
			</table>
		</div>

	</body>
</html>
<script>
	function sleep(ms) {
	 	return new Promise(resolve => setTimeout(resolve, ms));
	}
	var canvas = document.getElementById("canvas")
	var label = document.getElementById("label")
	var shedule = document.getElementById("shedule")
	var ctx = canvas.getContext("2d")
	ctx.fillStyle = "red"

	var start_time = new Date(2020,3,30,12,37,1);			
	var iter_time = 3668500;
	var ax = 120;
	var ay = 130;
	var bx = 830;
	var by = 420;
	var timer = 0;
	var x = 0;
	var y = 0;

	async function loop(timestamp) {
		var timer = Date.now() - start_time;
		var pos = timer % iter_time;
		if (pos < iter_time / 3){
			x = ax;
			y = ay;
			var date = new Date();
			date.setTime(iter_time/3-pos);
			label.innerHTML = `Стоянка в Двух Коронах ${date.getMinutes()} м ${date.getSeconds()} с`;
		} else if (pos < iter_time / 2){
			var i = (pos - iter_time/3)/(iter_time/6);
			var j = Math.abs(i-0.5)*2
			i *= i;
			j *= j;
			x = ax + (bx-ax)*i;
			y = ay + (by-ay)*i*j + (by+ay)*(1-j)/2;
			var date = new Date();
			date.setTime(iter_time/2-pos);
			label.innerHTML = `Прибытие в Ост-Терру через ${date.getMinutes()} м ${date.getSeconds()} с`;
		} else if (pos < 5 * iter_time / 6){
			x = bx;
			y = by;
			var date = new Date();
			date.setTime(iter_time*5/6-pos);
			label.innerHTML = `Стоянка в Ост-Терре ${date.getMinutes()} м ${date.getSeconds()} с`;
		} else{
			var i = (pos - 5*iter_time/6)/(iter_time/6);
			var j = Math.abs(0.5-i)*2
			i = 1-i;
			i *= i;
			i = 1-i;
			j *= j;
			x = ax + (bx-ax)*(1-i);
			y = ay + (by-ay)*(1-i)*j + (by+ay)*(1-j)/2;
			var date = new Date();
			date.setTime(iter_time-pos);
			label.innerHTML = `Прибытие в Две Короны через ${date.getMinutes()} м ${date.getSeconds()} с`;
		}
		ctx.clearRect(0, 0, canvas.width, canvas.height)
			ctx.beginPath();
		ctx.arc( x, y, 8,0,2*Math.PI)
	  	ctx.fill()
	  	await sleep(300)
	  	window.requestAnimationFrame(loop)
	}
	window.requestAnimationFrame(loop)
	var cur_timestamp = Date.now() - start_time;
	cur_timestamp = cur_timestamp - cur_timestamp % iter_time;
	cur_timestamp+=start_time;
	for (var i = 0; i < 10; i++) {
		var line = "<tr>";

		var date = new Date();
		var row = shedule.insertRow();		
		var offset = (start_time / 1)+iter_time*i
		date.setTime(offset);
		line += `<td>${date.getHours().toString().padStart(2, "0")}:${date.getMinutes().toString().padStart(2, "0")}</td>`;

		date.setTime(offset+iter_time/3);
		line += `<td>${date.getHours().toString().padStart(2, "0")}:${date.getMinutes().toString().padStart(2, "0")}</td>`;

		date.setTime(offset+iter_time/2);
		line += `<td>${date.getHours().toString().padStart(2, "0")}:${date.getMinutes().toString().padStart(2, "0")}</td>`;

		date.setTime(offset+iter_time*5/6);
		line += `<td>${date.getHours().toString().padStart(2, "0")}:${date.getMinutes().toString().padStart(2, "0")}</td>`;

		line += "</tr>";
		row.innerHTML = line
	}
</script>
<style>
html{

	font-family: Arial;
	font-size: 24;
	text-align: center;
}

canvas{
	z-index: 1;
	position: absolute;	
}
.container{
	max-width: 1000px;
    background: radial-gradient(circle, white 0%, rgb(222,222,222) 100%);
    box-shadow: 0 0 2px black;
    border-radius: 16px;
    margin: 16px auto;
    padding: 0px;
    overflow: auto;
}
td{
	text-align: center;

	font-size: 36;
}
table{width:100%;}

		</style>
